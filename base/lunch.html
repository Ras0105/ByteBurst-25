<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lunch Chart ‚Äì Smart Mess</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; background: #fefefe; padding: 30px; text-align: center; }
    h2 { margin-bottom: 10px; color: #333; }
    input, button { padding: 8px; margin: 5px; width: 200px; }
    button { background-color: #007bff; color: white; font-weight: bold; border: none; cursor: pointer; width: auto; }
    canvas { margin-top: 30px; max-width: 700px; width: 100%; }
    a { text-decoration: none; color: #28a745; display: inline-block; margin-top: 30px; }
  </style>
</head>
<body>
  <h2>ü•ó Lunch Dish Popularity ‚Äì <span id="todayDate"></span></h2>
  <input type="date" id="datePicker"><button onclick="loadChart()">Load</button><br><br>
  <input type="text" id="dishName" placeholder="Dish Name">
  <input type="number" id="dishVotes" placeholder="Votes / Count"><br>
  <button onclick="addDish()">Add to Chart</button>
  <canvas id="lunchChart"></canvas>
  <a href="chart.html">‚¨ÖÔ∏è Back</a>

  <script>
    let currentDate = new Date().toLocaleDateString('en-CA');
    document.getElementById('todayDate').textContent = currentDate;
    document.getElementById('datePicker').value = currentDate;
    const ctx = document.getElementById('lunchChart').getContext('2d');
    let chart;

    function loadChart() {
      currentDate = document.getElementById('datePicker').value;
      document.getElementById('todayDate').textContent = currentDate;
      const key = `smartmess_lunch_${currentDate}`;
      const stored = JSON.parse(localStorage.getItem(key)) || { labels: [], data: [], colors: [] };
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: stored.labels,
          datasets: [{ label: 'Votes', data: stored.data, backgroundColor: stored.colors, borderRadius: 6 }]
        },
        options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'Votes / Students' } } } }
      });
    }

    function getRandomColor() {
      return '#' + Math.floor(Math.random()*16777215).toString(16);
    }

    function addDish() {
      const name = document.getElementById('dishName').value.trim();
      const votes = parseInt(document.getElementById('dishVotes').value);
      if (!name || isNaN(votes)) return alert("Please enter valid dish name and vote count.");
      const color = getRandomColor();
      chart.data.labels.push(name);
      chart.data.datasets[0].data.push(votes);
      chart.data.datasets[0].backgroundColor.push(color);
      chart.update();
      const key = `smartmess_lunch_${currentDate}`;
      localStorage.setItem(key, JSON.stringify({
        labels: chart.data.labels,
        data: chart.data.datasets[0].data,
        colors: chart.data.datasets[0].backgroundColor
      }));
      document.getElementById('dishName').value = '';
      document.getElementById('dishVotes').value = '';
    }

    loadChart();
  </script>
</body>
</html>
